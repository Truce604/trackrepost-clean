<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buy Credits | TrackRepost</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header id="site-header"></header>

  <main class="container" style="max-width: 600px; margin: 0 auto; padding: 2rem; text-align: center;">
    <h1>ğŸ’³ Buy Credits</h1>
    <p style="color:#ccc;margin-bottom:1.5rem;">Use credits to promote your tracks to real SoundCloud users.</p>

    <div style="display:flex; flex-direction:column; gap:1rem;">
      <button onclick="buyCredits(500, 2499)" class="credit-btn">ğŸ”¥ 500 Credits â€“ $24.99</button>
      <button onclick="buyCredits(1000, 3499)" class="credit-btn">ğŸš€ 1000 Credits â€“ $34.99</button>
      <button onclick="buyCredits(2500, 7999)" class="credit-btn">ğŸ’¼ 2500 Credits + Artist Plan â€“ $79.99</button>
      <button onclick="buyCredits(5000, 13999)" class="credit-btn">ğŸ¯ 5000 Credits + Network Plan â€“ $139.99</button>
      <button onclick="buyCredits(25000, 54999)" class="credit-btn">ğŸ‘‘ 25,000 Credits + Promoter Plan â€“ $549.99</button>
    </div>

    <div id="status" style="margin-top:2rem; color:#0f0;"></div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="/js/firebaseConfig.js"></script>

  <!-- Core Logic -->
  <script>
    const auth = firebase.auth();
    const db = firebase.firestore();

    async function buyCredits(credits, priceCents) {
      const user = auth.currentUser;
      if (!user) {
        alert("Please log in to buy credits.");
        return;
      }

      try {
        const response = await fetch("/api/square/checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: user.uid,
            credits,
            amount: priceCents,
          }),
        });

        if (!response.ok) throw new Error("âŒ Checkout failed");

        const data = await response.json();
        if (data.checkoutUrl) {
          window.location.href = data.checkoutUrl;
        } else {
          throw new Error("âŒ Invalid checkout URL");
        }
      } catch (err) {
        console.error("âŒ Error creating checkout:", err);
        document.getElementById("status").textContent = "Failed to create checkout. Try again.";
      }
    }
  </script>

  <!-- Optional UI scripts -->
  <script src="/js/header.js"></script>
</body>
</html>













